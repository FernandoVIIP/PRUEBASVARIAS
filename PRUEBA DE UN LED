import RPi.GPIO as GPIO
import time

# Configuración de los pines
Pin_Sensor = 5  # Pin GPIO para la señal del sensor de obstáculos
Pin_Led = 25    # Pin GPIO para el LED

# Configuración de la biblioteca RPi.GPIO
GPIO.setmode(GPIO.BCM)  # Usar numeración BCM de los pines GPIO

# Configurar el pin del sensor como entrada y el pin del LED como salida
GPIO.setup(Pin_Sensor, GPIO.IN)
GPIO.setup(Pin_Led, GPIO.OUT)

try:
    while True:
        sensor_state = GPIO.input(Pin_Sensor)
        if sensor_state == 0:  # Si el sensor detecta un obstáculo
            GPIO.output(Pin_Led, GPIO.HIGH)  # Encender el LED
        else:  # Si el sensor no detecta un obstáculo
            GPIO.output(Pin_Led, GPIO.LOW)   # Apagar el LED
        
        time.sleep(0.1)  # Pequeña pausa para evitar una carga excesiva de la CPU

except KeyboardInterrupt:
    pass  # Permitir salir del bucle con Ctrl+C

finally:
    GPIO.cleanup()  # Limpiar la configuración de los pines GPIO


# ESTA ES LA PRUEBA EN LA RASPERRY CON UN LED Y UN INFRARROJO



import RPi.GPIO as GPIO
import MFRC522
import signal
import time

# Configura los pines GPIO
servo_pin = 17
led_pin = 18

GPIO.setmode(GPIO.BCM)
GPIO.setup(servo_pin, GPIO.OUT)
GPIO.setup(led_pin, GPIO.OUT)

# Configura el lector RFID
MIFAREReader = MFRC522.MFRC522()

try:
    while True:
        # Lógica de lectura RFID
        (status, TagType) = MIFAREReader.MFRC522_Request(MIFAREReader.PICC_REQIDL)
        if status == MIFAREReader.MI_OK:
            print("Tarjeta detectada")

            # Obtener ID de la tarjeta
            (status, uid) = MIFAREReader.MFRC522_Anticoll()

            # Verificar si es el ID deseado
            if uid == [0x**REEMPLAZAR CON TU ID DE TARJETA**]:  # Reemplazar con el ID correcto
                print("Acceso permitido")
                
                # Activar servo a 180 grados
                p = GPIO.PWM(servo_pin, 50)
                p.start(2.5)  # Posición inicial del servo
                p.ChangeDutyCycle(7.5)  # Gira a 180 grados
                time.sleep(1)
                
                # Encender el LED
                GPIO.output(led_pin, GPIO.HIGH)
                time.sleep(3)
                GPIO.output(led_pin, GPIO.LOW)
                
                p.stop()  # Detener el servo
            else:
                print("Acceso denegado")
        
        time.sleep(0.1)

except KeyboardInterrupt:
    GPIO.cleanup()

